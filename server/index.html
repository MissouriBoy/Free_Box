<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Free Jukebox</title>
  <link type="text/css" rel="stylesheet" href="styles.css">
  <script src="script.js" type="text/javascript"></script>
</head>
<body>
    <div class="navbar">
        <h2 id="acm">The Free Jukebox</h1>
        <div id="links-section">
        </div>
    </div>
    
    <div class="Player">
        <h2>The music player for all players.</h1>
    </div>

    <audio
        controls
        id="player"
        src="https://s3.us-east-2.amazonaws.com/freejukebox.space/Downforce.wav">
            Your browser does not support the
            <code>audio</code> element.
    </audio>
    <p id="time">Time:</p>
    <script>
        var pause = 0;
        var play = 0;
        var seek = 0;
        var received_msg = "";
        var id = 0;
        var initialize = false;

        const audio = document.getElementById("player");
        var ip = prompt("Please enter the ip address you want to connect to.", "localhost");

        // Let us open a web socket
        var ws = new WebSocket("ws://" + ip + ":8080");

        audio.addEventListener('playing', (event) => {
            var pie = { 
                identifier: id,
                message: "Play"
            }
            console.log('Video is no longer paused');
            play = 1;
            ws.send("Play");
        });

        audio.addEventListener('pause', (event) => {
            var pie = { 
                identifier: id,
                message: "Pause"
            }
            console.log('Video is paused');
            pause = 1;
            ws.send("Pause");
        });
        
        audio.addEventListener('seeked', (event) => {
            var pie = { 
                identifier: id,
                message: document.getElementById("player").currentTime
            }
            ws.send(document.getElementById("player").currentTime);
            seek = 0;
        });

        // Universal volume control (If you want)
        
        function WebSocketTest() {
            
            if ( "WebSocket" in window ) {             
                ws.onopen = function() {  

                };
				
                ws.onmessage = function (evt) { 
                    received_msg = evt.data;
                    console.log(received_msg);
                    if( initialize === true ) {
                        if ( received_msg === "Play" ) {
                            if( play === 0 ) {
                                audio.play();
                            } else {
                                play = 0;
                            }
                        }
                        else if ( received_msg === "Pause" ) {
                            if( pause === 0 ) {
                                audio.pause();
                            } else {
                                pause = 0;
                            }
                        }
                        else {
                            console.log(received_msg);
                            stopSeek();
                            seek++;
                        }
                    } else {
                        id = parseInt(received_msg);
                        initialize = true;
                    }
                };
				
                ws.onclose = function() { 
                    // websocket is closed.
                    alert("Connection is closed..."); 
                };
            } else {
              
                // The browser doesn't support WebSocket
                alert("WebSocket NOT supported by your Browser!");
            }
        }
        
        function stopSeek() {
            if ( seek <= 0 ) {
                audio.currentTime = parseFloat(received_msg);
            }
        }

        WebSocketTest()
    </script>
</body>
</html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Free Jukebox</title>
  <link type="text/css" rel="stylesheet" href="styles.css">
  <script src="script.js" type="text/javascript"></script>
</head>
<body>
    <div class="navbar">
        <h2 id="acm">The Free Jukebox</h1>
        <div id="links-section">
        </div>
    </div>
    
    <div class="Player">
        <h2>The music player for all players.</h1>
    </div>

    <audio
        controls
        id="player"
        src="music.flac">
            Your browser does not support the
            <code>audio</code> element.
    </audio>
    <p id="time">Time:</p>
    <script>
        var pause = 0;
        var play = 0;
        var seek = 0;
        var received_msg = "";
        var id = 0;
        var initialize = false;
        var commandDisable = false;
        var ws;

        const audio = document.getElementById("player");
        var ip = prompt("Please enter the ip address you want to connect to.", "localhost");

        audio.addEventListener('playing', (event) => {
            var pie = { 
                identifier: id,
                message: "Play"
            }

            if ( commandDisable === false ) {
                ws.send(JSON.stringify(pie));
            }
            commandDisable = false;
        });

        audio.addEventListener('pause', (event) => {
            var pie = { 
                identifier: id,
                message: "Pause"
            }

            if ( commandDisable === false ) {
                ws.send(JSON.stringify(pie));
            }
            commandDisable = false;
        });
        
        audio.addEventListener('seeked', (event) => {
            var pie = { 
                identifier: id,
                message: document.getElementById("player").currentTime
            }

            if ( commandDisable === false ) {
                ws.send(JSON.stringify(pie));
            }
            commandDisable = false;
        });

        // Universal volume control (If you want)
        
        function WebSocketTest() {
            
            if ( "WebSocket" in window ) {    
                
                ws = new WebSocket("ws://" + ip + ":8080");

                ws.onopen = function() {
                    
                };
				
                ws.onmessage = function async (evt) { 
                    received_msg = evt.data;
                    console.log(received_msg);
                    if( initialize === true ) {
                        commandDisable = true;

                        if ( received_msg === "Play" ) {
                            audio.play();
                        }
                        else if ( received_msg === "Pause" ) {
                            audio.pause();
                        }
                        else {
                            audio.currentTime = parseFloat(received_msg);
                        }
                    } else {
                        id = parseInt(received_msg);
                        alert( "Your ID is " + id );
                        initialize = true;
                    }
                };
				
                ws.onclose = function() { 
                    // websocket is closed.
                    alert("Connection is closed..."); 
                };
            } else {
              
                // The browser doesn't support WebSocket
                alert("WebSocket NOT supported by your Browser!");
            }
        }

        WebSocketTest()
    </script>
</body>
</html>